# Bot Blocking Configuration
# Blocks malicious bots, scanners, and mining software

# Map bad user agents
map $http_user_agent $bad_bot {
    default 0;

    # Vulnerability scanners
    ~*zgrab 1;
    ~*masscan 1;
    ~*nmap 1;
    ~*sqlmap 1;
    ~*nikto 1;
    ~*acunetix 1;
    ~*netsparker 1;
    ~*webinspect 1;
    ~*metis 1;
    ~*appscan 1;

    # Cryptocurrency miners
    ~*XMRig 1;
    ~*cpuminer 1;
    ~*ethminer 1;
    ~*cgminer 1;
    ~*bfgminer 1;
    ~*minerd 1;

    # Scrapers and harvesters
    ~*emailcollector 1;
    ~*emailsiphon 1;
    ~*emailwolf 1;
    ~*extractorpro 1;
    ~*copyrightcheck 1;

    # Known malicious bots
    ~*semrush 1;
    ~*ahrefsbot 1;
    ~*mj12bot 1;
    ~*dotbot 1;
    ~*crawler4j 1;
    ~*lipperhey 1;
    ~*linkdexbot 1;
    ~*blexbot 1;

    # Exploit tools
    ~*havij 1;
    ~*w3af 1;
    ~*metasploit 1;
    ~*beef 1;
    ~*nessus 1;
    ~*openvas 1;

    # Generic suspicious patterns
    ~*bot@linkfluence 1;
    ~*MauiBot 1;
    ~*SemrushBot 1;
    ~*python-requests 1;
    ~*curl 1;
    ~*wget 1;
    ~*libwww-perl 1;

    # Empty user agent (very suspicious)
    "" 1;
}

# Map to check for allowed/known good bots
map $http_user_agent $allowed_bot {
    default 0;

    # Search engines
    ~*googlebot 1;
    ~*bingbot 1;
    ~*yandex 1;
    ~*duckduckbot 1;

    # Monitoring services
    ~*uptimerobot 1;
    ~*pingdom 1;
    ~*newrelic 1;
    ~*datadog 1;

    # Social media crawlers
    ~*facebookexternalhit 1;
    ~*twitterbot 1;
    ~*linkedinbot 1;
    ~*slackbot 1;
    ~*discordbot 1;
}

# Final decision: block if bad bot and not explicitly allowed
map $http_user_agent $block_bot {
    default 0;
    "~*$bad_bot" 1;
}

# Override block if allowed
geo $allowed_override {
    default 0;
}
