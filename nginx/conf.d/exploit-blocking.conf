# Exploit Path Blocking Configuration
# Blocks common exploit attempts and vulnerability scans

# Block access to hidden files (except .well-known for ACME)
location ~ /\.(?!well-known) {
    deny all;
    return 444;
}

# Block access to common admin panels (not used by this application)
location ~* ^/(admin|administrator|wp-admin|wp-login|phpmyadmin|pma|myadmin|mysql|sqlmanager|phppgadmin|pgadmin|adminer) {
    deny all;
    return 444;
}

# Block access to configuration files
location ~* ^/(config|configuration|settings|setup|install)\.php$ {
    deny all;
    return 444;
}

# Block access to backup files
location ~* \.(bak|backup|old|orig|save|swp|~)$ {
    deny all;
    return 444;
}

# Block access to system files
location ~* ^/(xmlrpc\.php|readme\.html|license\.txt)$ {
    deny all;
    return 444;
}

# Block CGI and script directories
location ~* ^/(cgi-bin|cgi-sys|scripts|ScriptResource\.axd) {
    deny all;
    return 444;
}

# Block Microsoft Exchange/OWA endpoints
location ~* ^/(owa|exchange|autodiscover|ecp|mapi|rpc) {
    deny all;
    return 444;
}

# Block router and IoT device paths
location ~* ^/(login\.rsp|apply\.cgi|setup\.cgi|HNAP1|wan\.htm) {
    deny all;
    return 444;
}

# Block mining protocol paths
location ~* ^/(mining|stratum|getwork|eth_submitLogin|eth_submitWork|eth_getWork) {
    deny all;
    return 444;
}

# Block common exploit paths
location ~* ^/(vendor|api/v1/pods|solr/admin|jenkins|axis2|manager) {
    deny all;
    return 444;
}

# Block file extensions not used by this application
location ~* \.(php|asp|aspx|jsp|cgi|pl|py|sh|bat|exe|dll|msi)$ {
    deny all;
    return 444;
}

# Block SQL files
location ~* \.(sql|sqlite|db)$ {
    deny all;
    return 444;
}

# Block requests with suspicious query strings
if ($query_string ~* "(<|%3C).*script.*(>|%3E)") {
    return 444;
}

if ($query_string ~* "GLOBALS(=|\[|\%[0-9A-Z]{0,2})") {
    return 444;
}

if ($query_string ~* "_REQUEST(=|\[|\%[0-9A-Z]{0,2})") {
    return 444;
}

if ($query_string ~* "proc/self/environ") {
    return 444;
}

if ($query_string ~* "mosConfig_[a-zA-Z_]{1,21}(=|\%3D)") {
    return 444;
}

if ($query_string ~* "base64_(en|de)code\(.*\)") {
    return 444;
}

# Block requests with null bytes
if ($query_string ~* "\0") {
    return 444;
}

# Block requests trying to set PHP globals
if ($query_string ~* "php://") {
    return 444;
}

# Block requests trying to modify cURL
if ($query_string ~* "curl") {
    return 444;
}
